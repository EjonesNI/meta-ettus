From a4fc2c07df9fe8eb6c40d8eee1bff16fba83e584 Mon Sep 17 00:00:00 2001
From: Philip Balister <philip@opensdr.com>
Date: Wed, 14 Dec 2016 16:43:28 -0800
Subject: [PATCH 2/3] Updates to Ettus Sulfur for use with mender.

Signed-off-by: Philip Balister <philip@opensdr.com>
---
 include/configs/ni_sulfur_rev2.h | 10 ++++++++--
 include/configs/zynq-common.h    | 16 ----------------
 2 files changed, 8 insertions(+), 18 deletions(-)

diff --git a/include/configs/ni_sulfur_rev2.h b/include/configs/ni_sulfur_rev2.h
index 2aa2f90..30d2ec5 100644
--- a/include/configs/ni_sulfur_rev2.h
+++ b/include/configs/ni_sulfur_rev2.h
@@ -12,9 +12,15 @@
 
 #include "zynq-common.h"
 
+#define CONFIG_BOOTCOUNT_LIMIT
+#define CONFIG_BOOTCOUNT_ENV
+
+#define CONFIG_ENV_IS_IN_MMC
+
 #undef CONFIG_EXTRA_ENV_SETTINGS
 #define CONFIG_EXTRA_ENV_SETTINGS	\
 	"fit_image=fit.itb\0"		\
+	"bootargs=root=${mender_kernel_root} rw rootwait\0" \
 	"load_addr=0x2000000\0"		\
 	"fit_size=0x800000\0"		\
 	"fdt_high=0x20000000\0"		\
@@ -43,8 +49,8 @@
 				"run uenvcmd; " \
 			"fi; " \
 		"fi; \0" \
-	"sdboot=echo Copying FIT from SD to RAM... && " \
-		"load mmc 0 ${load_addr} ${fit_image} && " \
+	"sdboot=run mender_setup; echo Copying FIT from SD to RAM... && " \
+		"load ${mender_uboot_root} ${load_addr} ${fit_image} && " \
 		"bootm ${load_addr}\0" \
 	"jtagboot=echo TFTPing FIT to RAM... && " \
 		"tftpboot ${load_addr} ${fit_image} && " \
diff --git a/include/configs/zynq-common.h b/include/configs/zynq-common.h
index 4f0253c..7f2ec6f 100644
--- a/include/configs/zynq-common.h
+++ b/include/configs/zynq-common.h
@@ -159,22 +159,6 @@
 /* Allow to overwrite serial and ethaddr */
 #define CONFIG_ENV_OVERWRITE
 
-/* Environment */
-#ifndef CONFIG_ENV_IS_NOWHERE
-# ifndef CONFIG_SYS_NO_FLASH
-/* Environment in NOR flash */
-#  define CONFIG_ENV_IS_IN_FLASH
-# elif defined(CONFIG_ZYNQ_QSPI)
-/* Environment in Serial Flash */
-#  define CONFIG_ENV_IS_IN_SPI_FLASH
-# elif defined(CONFIG_SYS_NO_FLASH)
-#  define CONFIG_ENV_IS_NOWHERE
-# endif
-
-# define CONFIG_ENV_SECT_SIZE		CONFIG_ENV_SIZE
-# define CONFIG_ENV_OFFSET		0xE0000
-#endif
-
 /* enable preboot to be loaded before CONFIG_BOOTDELAY */
 #define CONFIG_PREBOOT
 
-- 
2.7.4

