From 2c142a542bed1d81d38dcef533d634503638e58b Mon Sep 17 00:00:00 2001
From: Moritz Fischer <moritz.fischer@ettus.com>
Date: Tue, 4 Apr 2017 13:20:28 -0700
Subject: [PATCH 11/13] fixup! ni: zynq: Add support for NI Ettus Research
 Project Sulfur Rev3 SDR

Signed-off-by: Moritz Fischer <moritz.fischer@ettus.com>
---
 configs/ni_sulfur_rev3_defconfig | 1 +
 include/configs/ni_sulfur_rev3.h | 7 ++++---
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/configs/ni_sulfur_rev3_defconfig b/configs/ni_sulfur_rev3_defconfig
index 8134689..2363424 100644
--- a/configs/ni_sulfur_rev3_defconfig
+++ b/configs/ni_sulfur_rev3_defconfig
@@ -3,6 +3,7 @@ CONFIG_SYS_VENDOR="ni"
 CONFIG_SYS_CONFIG_NAME="ni_sulfur_rev3"
 CONFIG_ARCH_ZYNQ=y
 CONFIG_DEFAULT_DEVICE_TREE="zynq-ni-sulfur-rev3"
+CONFIG_SYS_EXTRA_OPTIONS="BOOTCOUNT_LIMIT,BOOTCOUNT_ENV,ENV_IS_IN_MMC"
 CONFIG_FIT=y
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_SPL=y
diff --git a/include/configs/ni_sulfur_rev3.h b/include/configs/ni_sulfur_rev3.h
index 015ac9c..a381d15 100644
--- a/include/configs/ni_sulfur_rev3.h
+++ b/include/configs/ni_sulfur_rev3.h
@@ -14,7 +14,8 @@
 
 #undef CONFIG_EXTRA_ENV_SETTINGS
 #define CONFIG_EXTRA_ENV_SETTINGS	\
-	"fit_image=fit.itb\0"		\
+	"fit_image=boot/fitImage\0"	\
+	"bootargs=root=${mender_kernel_root} rw rootwait\0" \
 	"load_addr=0x2000000\0"		\
 	"fit_size=0x800000\0"		\
 	"fdt_high=0x20000000\0"		\
@@ -43,8 +44,8 @@
 				"run uenvcmd; " \
 			"fi; " \
 		"fi; \0" \
-	"sdboot=echo Copying FIT from SD to RAM... && " \
-		"load mmc 0 ${load_addr} ${fit_image} && " \
+	"sdboot=run mender_setup; echo Copying FIT from SD to RAM... && " \
+		"ext4load ${mender_uboot_root} ${load_addr} ${fit_image} && " \
 		"bootm ${load_addr}\0" \
 	"jtagboot=echo TFTPing FIT to RAM... && " \
 		"tftpboot ${load_addr} ${fit_image} && " \
-- 
2.7.4

